# Repository Guidelines

## Project Structure & Module Organization
This repo is a Rust Cargo workspace with two primary crates:
- `crates/pwf-core/` library crate for parsing and validation (`src/plan/`, `src/history/`, `src/error.rs`, `src/types.rs`).
- `crates/pwf-cli/` CLI crate (`src/main.rs`) exposing `validate`, `history`, and `init`.
Supporting assets: `schema/` JSON Schemas, `examples/` YAML fixtures (and `examples/invalid/`), and `docs/` (spec and blocks). See `docs/modalities.md` for supported exercise modalities.

## Architecture & Validation Flow
Plan and history validation follow a parser/validator split: `parser.rs` deserializes YAML, `validator.rs` enforces rules. Error codes are part of the API: plans use `PWF-P###` and history uses `PWF-H###`. When you change validation logic, update the matching schema (`schema/pwf-v1.json` or `schema/pwf-history-v1.json`) and relevant docs.

## Build, Test, and Development Commands
Common commands:
```bash
cargo build --release -p pwf
cargo test --all-features --workspace
cargo test -p pwf-core
cargo test -- --nocapture
cargo fmt --all
cargo clippy --all-targets --all-features -- -D warnings
```
CLI examples:
```bash
./target/release/pwf validate examples/beginner-strength.yaml
./target/release/pwf validate --strict examples/minimal.yaml
./target/release/pwf history examples/history-export.yaml
./target/release/pwf init my-plan.yaml
./target/release/pwf init --history my-export.yaml
```

## Coding Style & Naming Conventions
- Rust: `rustfmt` defaults, `clippy` with warnings-as-errors, no `unwrap()` in library code, document public APIs with `///`.
- YAML examples: 2-space indentation and realistic data.
- Docs: ATX headers and fenced code blocks with relative links.

## Testing Guidelines
Integration tests live at `crates/pwf-core/tests/integration_tests.rs`; CLI tests are under `crates/pwf-cli/tests/` (using `assert_cmd`). CI enforces 90% coverage. Add/adjust fixtures in `examples/` and `examples/invalid/` for new behavior.

## Commit & Pull Request Guidelines
Commit messages are short, imperative, and human-authored (no AI attribution). Do not open GitHub issues or PRs based on autogenerated suggestions without maintainer discussion. PRs should include tests for new behavior, docs/examples as needed, and a `CHANGELOG.md` update for user-visible changes. Spec changes require backwards compatibility and synchronized schema + validator updates.
