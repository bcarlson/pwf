{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://pwf.dev/schema/v2/history.json",
  "title": "PWF History Export v2",
  "description": "Schema for validating PWF workout history exports with telemetry support",
  "type": "object",
  "required": ["history_version", "exported_at", "workouts"],
  "additionalProperties": false,
  "properties": {
    "history_version": {
      "type": "integer",
      "const": 2,
      "description": "Specification version (must be 2)"
    },
    "exported_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime when export was created"
    },
    "export_source": {
      "$ref": "#/$defs/ExportSource"
    },
    "units": {
      "$ref": "#/$defs/Units"
    },
    "workouts": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Workout"
      },
      "description": "Completed workout sessions"
    },
    "personal_records": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/PersonalRecord"
      },
      "description": "Personal records achieved"
    },
    "body_measurements": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/BodyMeasurement"
      },
      "description": "Body measurements recorded"
    }
  },
  "$defs": {
    "ExportSource": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "app_name": {
          "type": "string",
          "description": "Application name"
        },
        "app_version": {
          "type": "string",
          "description": "Application version"
        },
        "platform": {
          "type": "string",
          "enum": ["ios", "android", "web", "desktop"],
          "description": "Platform"
        },
        "preferred_units": {
          "$ref": "#/$defs/Units",
          "description": "User's preferred units"
        }
      }
    },
    "Units": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "weight": {
          "type": "string",
          "enum": ["kg", "lb"],
          "default": "kg"
        },
        "distance": {
          "type": "string",
          "enum": ["meters", "kilometers", "miles", "feet", "yards"],
          "default": "meters"
        }
      }
    },
    "Workout": {
      "type": "object",
      "required": ["date", "exercises"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique workout identifier"
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "Workout date (YYYY-MM-DD)"
        },
        "started_at": {
          "type": "string",
          "format": "date-time",
          "description": "Start timestamp"
        },
        "ended_at": {
          "type": "string",
          "format": "date-time",
          "description": "End timestamp"
        },
        "duration_sec": {
          "type": "integer",
          "minimum": 0,
          "description": "Total duration in seconds"
        },
        "title": {
          "type": "string",
          "description": "Workout title"
        },
        "notes": {
          "type": "string",
          "description": "Workout notes"
        },
        "plan_id": {
          "type": "string",
          "description": "Reference to PWF plan"
        },
        "plan_day_id": {
          "type": "string",
          "description": "Reference to plan day"
        },
        "exercises": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/CompletedExercise"
          },
          "description": "Exercises performed"
        },
        "telemetry": {
          "$ref": "#/$defs/WorkoutTelemetry",
          "description": "Workout-level telemetry metrics (v2)"
        }
      }
    },
    "CompletedExercise": {
      "type": "object",
      "required": ["name", "sets"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique exercise identifier"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Exercise name"
        },
        "modality": {
          "type": "string",
          "enum": ["strength", "countdown", "stopwatch", "interval", "cycling", "running", "rowing", "swimming"],
          "description": "Exercise modality"
        },
        "notes": {
          "type": "string",
          "description": "Exercise-level notes"
        },
        "sets": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/CompletedSet"
          },
          "description": "Completed sets"
        }
      }
    },
    "CompletedSet": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "set_number": {
          "type": "integer",
          "minimum": 1,
          "description": "Set order (1-indexed)"
        },
        "set_type": {
          "type": "string",
          "enum": ["working", "warmup", "dropset", "failure", "amrap"],
          "default": "working",
          "description": "Type of set"
        },
        "reps": {
          "type": "integer",
          "minimum": 0,
          "description": "Repetitions completed"
        },
        "weight_kg": {
          "type": "number",
          "minimum": 0,
          "description": "Weight in kilograms"
        },
        "weight_lb": {
          "type": "number",
          "minimum": 0,
          "description": "Weight in pounds"
        },
        "duration_sec": {
          "type": "integer",
          "minimum": 0,
          "description": "Duration in seconds"
        },
        "distance_meters": {
          "type": "number",
          "minimum": 0,
          "description": "Distance in meters"
        },
        "rpe": {
          "type": "number",
          "minimum": 0,
          "maximum": 10,
          "description": "Rate of Perceived Exertion (0-10 scale)"
        },
        "rir": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "description": "Reps in Reserve (alternative to RPE)"
        },
        "notes": {
          "type": "string",
          "description": "Set-level notes"
        },
        "is_pr": {
          "type": "boolean",
          "description": "Whether this set was a personal record"
        },
        "completed_at": {
          "type": "string",
          "format": "date-time",
          "description": "When set was completed"
        },
        "telemetry": {
          "$ref": "#/$defs/SetTelemetry",
          "description": "Set-level telemetry metrics (v2)"
        }
      }
    },
    "SetTelemetry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "heart_rate_avg": {
          "type": "integer",
          "minimum": 0,
          "maximum": 250,
          "description": "Average heart rate (bpm)"
        },
        "heart_rate_max": {
          "type": "integer",
          "minimum": 0,
          "maximum": 250,
          "description": "Maximum heart rate (bpm)"
        },
        "heart_rate_min": {
          "type": "integer",
          "minimum": 0,
          "maximum": 250,
          "description": "Minimum heart rate (bpm)"
        },
        "power_avg": {
          "type": "integer",
          "minimum": 0,
          "description": "Average power (watts)"
        },
        "power_max": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum power (watts)"
        },
        "power_min": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum power (watts)"
        },
        "elevation_gain_m": {
          "type": "number",
          "minimum": 0,
          "description": "Elevation gain in meters"
        },
        "elevation_gain_ft": {
          "type": "number",
          "minimum": 0,
          "description": "Elevation gain in feet"
        },
        "elevation_loss_m": {
          "type": "number",
          "minimum": 0,
          "description": "Elevation loss in meters"
        },
        "elevation_loss_ft": {
          "type": "number",
          "minimum": 0,
          "description": "Elevation loss in feet"
        },
        "speed_avg_mps": {
          "type": "number",
          "minimum": 0,
          "description": "Average speed in meters per second"
        },
        "speed_avg_kph": {
          "type": "number",
          "minimum": 0,
          "description": "Average speed in km/h"
        },
        "speed_avg_mph": {
          "type": "number",
          "minimum": 0,
          "description": "Average speed in mph"
        },
        "speed_max_mps": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum speed in meters per second"
        },
        "speed_max_kph": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum speed in km/h"
        },
        "speed_max_mph": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum speed in mph"
        },
        "pace_avg_sec_per_km": {
          "type": "integer",
          "minimum": 0,
          "description": "Average pace in seconds per kilometer"
        },
        "pace_avg_sec_per_mi": {
          "type": "integer",
          "minimum": 0,
          "description": "Average pace in seconds per mile"
        },
        "cadence_avg": {
          "type": "integer",
          "minimum": 0,
          "description": "Average cadence (steps/min or RPM)"
        },
        "cadence_max": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum cadence"
        },
        "temperature_c": {
          "type": "number",
          "description": "Temperature in Celsius"
        },
        "temperature_f": {
          "type": "number",
          "description": "Temperature in Fahrenheit"
        },
        "humidity_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Humidity percentage"
        },
        "calories": {
          "type": "integer",
          "minimum": 0,
          "description": "Calories burned"
        },
        "stroke_rate": {
          "type": "integer",
          "minimum": 0,
          "description": "Stroke rate for swimming/rowing"
        },
        "gps_route_id": {
          "type": "string",
          "description": "Reference to GPS route data"
        }
      }
    },
    "WorkoutTelemetry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "heart_rate_avg": {
          "type": "integer",
          "minimum": 0,
          "maximum": 250,
          "description": "Average heart rate for entire workout (bpm)"
        },
        "heart_rate_max": {
          "type": "integer",
          "minimum": 0,
          "maximum": 250,
          "description": "Maximum heart rate (bpm)"
        },
        "heart_rate_min": {
          "type": "integer",
          "minimum": 0,
          "maximum": 250,
          "description": "Minimum heart rate (bpm)"
        },
        "power_avg": {
          "type": "integer",
          "minimum": 0,
          "description": "Average power (watts)"
        },
        "power_max": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum power (watts)"
        },
        "total_distance_m": {
          "type": "number",
          "minimum": 0,
          "description": "Total distance in meters"
        },
        "total_distance_km": {
          "type": "number",
          "minimum": 0,
          "description": "Total distance in kilometers"
        },
        "total_distance_mi": {
          "type": "number",
          "minimum": 0,
          "description": "Total distance in miles"
        },
        "total_elevation_gain_m": {
          "type": "number",
          "minimum": 0,
          "description": "Total elevation gain in meters"
        },
        "total_elevation_gain_ft": {
          "type": "number",
          "minimum": 0,
          "description": "Total elevation gain in feet"
        },
        "total_elevation_loss_m": {
          "type": "number",
          "minimum": 0,
          "description": "Total elevation loss in meters"
        },
        "total_elevation_loss_ft": {
          "type": "number",
          "minimum": 0,
          "description": "Total elevation loss in feet"
        },
        "speed_avg_kph": {
          "type": "number",
          "minimum": 0,
          "description": "Average speed in km/h"
        },
        "speed_avg_mph": {
          "type": "number",
          "minimum": 0,
          "description": "Average speed in mph"
        },
        "speed_max_kph": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum speed in km/h"
        },
        "speed_max_mph": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum speed in mph"
        },
        "pace_avg_sec_per_km": {
          "type": "integer",
          "minimum": 0,
          "description": "Average pace in seconds per kilometer"
        },
        "pace_avg_sec_per_mi": {
          "type": "integer",
          "minimum": 0,
          "description": "Average pace in seconds per mile"
        },
        "cadence_avg": {
          "type": "integer",
          "minimum": 0,
          "description": "Average cadence (steps/min or RPM)"
        },
        "temperature_c": {
          "type": "number",
          "description": "Temperature in Celsius"
        },
        "temperature_f": {
          "type": "number",
          "description": "Temperature in Fahrenheit"
        },
        "humidity_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Humidity percentage"
        },
        "total_calories": {
          "type": "integer",
          "minimum": 0,
          "description": "Total calories burned"
        },
        "gps_route_id": {
          "type": "string",
          "description": "Reference to GPS route data"
        }
      }
    },
    "PersonalRecord": {
      "type": "object",
      "required": ["exercise_name", "record_type", "value", "achieved_at"],
      "additionalProperties": false,
      "properties": {
        "exercise_name": {
          "type": "string",
          "minLength": 1,
          "description": "Exercise name"
        },
        "record_type": {
          "type": "string",
          "enum": ["1rm", "max_weight_3rm", "max_weight_5rm", "max_weight_8rm", "max_weight_10rm", "max_weight", "max_reps", "max_volume", "max_duration", "max_distance", "fastest_time"],
          "description": "Type of record"
        },
        "value": {
          "type": "number",
          "description": "Record value"
        },
        "unit": {
          "type": "string",
          "description": "Unit for the value"
        },
        "achieved_at": {
          "type": "string",
          "format": "date",
          "description": "Date achieved"
        },
        "workout_id": {
          "type": "string",
          "description": "Reference to workout"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes"
        }
      }
    },
    "BodyMeasurement": {
      "type": "object",
      "required": ["date"],
      "additionalProperties": false,
      "properties": {
        "date": {
          "type": "string",
          "format": "date",
          "description": "Measurement date"
        },
        "recorded_at": {
          "type": "string",
          "format": "date-time",
          "description": "Exact timestamp"
        },
        "weight_kg": {
          "type": "number",
          "minimum": 0,
          "description": "Body weight in kg"
        },
        "weight_lb": {
          "type": "number",
          "minimum": 0,
          "description": "Body weight in lb"
        },
        "body_fat_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Body fat percentage"
        },
        "notes": {
          "type": "string",
          "description": "Notes"
        },
        "measurements": {
          "$ref": "#/$defs/BodyDimensions"
        }
      }
    },
    "BodyDimensions": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "neck_cm": { "type": "number", "minimum": 0 },
        "shoulders_cm": { "type": "number", "minimum": 0 },
        "chest_cm": { "type": "number", "minimum": 0 },
        "waist_cm": { "type": "number", "minimum": 0 },
        "hips_cm": { "type": "number", "minimum": 0 },
        "bicep_left_cm": { "type": "number", "minimum": 0 },
        "bicep_right_cm": { "type": "number", "minimum": 0 },
        "forearm_left_cm": { "type": "number", "minimum": 0 },
        "forearm_right_cm": { "type": "number", "minimum": 0 },
        "thigh_left_cm": { "type": "number", "minimum": 0 },
        "thigh_right_cm": { "type": "number", "minimum": 0 },
        "calf_left_cm": { "type": "number", "minimum": 0 },
        "calf_right_cm": { "type": "number", "minimum": 0 }
      }
    }
  }
}
